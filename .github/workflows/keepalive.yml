name: Keep Render Backend Warm

on:
  schedule:
    # Every 14 minutes (GitHub cron is best-effort; may drift slightly)
    - cron: "*/14 * * * *"
  workflow_dispatch: {}

jobs:
  ping:
    runs-on: ubuntu-latest
    timeout-minutes: 2
    steps:
      - name: Validate configuration
        run: |
          if [ -z "${{ secrets.KEEPALIVE_URL }}" ]; then
            echo "Missing required secret KEEPALIVE_URL"
            exit 1
          fi

      - name: Ping health endpoint
        env:
          KEEPALIVE_URL: ${{ secrets.KEEPALIVE_URL }}
        run: |
          echo "Pinging keepalive URL (masked)..."
          # Fail on non-2xx, follow redirects, retry transient failures.
          curl -fsSL --max-time 20 --retry 3 --retry-all-errors "$KEEPALIVE_URL"

